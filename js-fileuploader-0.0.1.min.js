var FileUploader=function(){function e(t){var n=this;if(!(this instanceof e))throw"FileUploader must be instantiated with `new`.";this.config={element:"js-file-uploader",url:void 0,callback:void 0,allowedExtensions:["xlsx","xls","txt","rtf","zip","pdf","doc","docx","jpg","gif","png","ppt","tif","pptx","csv"],template:this.template,testMode:!1};for(var i in t)this.config[i]=t[i];var o="string"==typeof this.config.element?document.getElementById(this.config.element):element;if(!o)throw"The file upload target element is undefined.";o.innerHTML=this.template;var r=o.querySelector('input[type="file"]');r.onchange=function(e){n.fileHandler(e,n)};var a=o.querySelector("button.btn-file-uploader");a.onclick=function(e){n.onSelect(e,n)},o.ondrop=function(e){n.onDrop(e,n)},o.ondragenter=n.cancel,o.ondragover=n.cancel;var s=o.querySelector("ul.file-upload-list");this.container=o,this.fileInput=r,this.btnUpload=a,this.fileList=s,this.observables={}}return e.prototype.template='<input type="file" class="file-uploader" multiple style="display:none;" /><button class ="btn btn-file-uploader">Click or Drop Files Here</button><ul class="file-upload-list"></ul>',e.prototype.fileHandler=function(t,n){if(n=n||this,!(n instanceof e))throw"Lost scope of this!";var i=n.fileInput.files;n.readFilesAsync(i)},e.prototype.onSelect=function(t,n){if(n=n||this,!(n instanceof e))throw"Lost scope of this!";n.cancel(t),n.fileInput.click()},e.prototype.onDrop=function(t,n){if(n=n||this,!(n instanceof e))throw"Lost scope of this!";n.cancel(t);var i=(t.originalEvent||t).dataTransfer,o=i.files;return o?void n.readFilesAsync(o):(console.warn("Error in FileUploader - event.dataTransfer.files is "+typeof o),!1)},e.prototype.readFilesAsync=function(t){var n=this;if(!(n instanceof e))throw"Lost scope of this!";this.fileList.innerHTML="";var i=[],o=Array.prototype.slice.call(t,0);o.map(function(e){var t=n.cleanFileName(e),o=n.isValidExtension(t),r=document.createElement("li");r.innerHTML=t+(o?"":"<strong>Only these file types are allowed: "+n.config.allowedExtensions.join(", ")+"</strong>"),n.fileList.appendChild(r),o&&(n.observables[t]=r,i.push(function(){n.readFileAsync(e,t),n.cafe.next(!0)}))}),n.cafe=new Cafe(i),n.cafe.start(!0)},e.prototype.readFileAsync=function(e,t){var n=this,i=n.getFileReader(n,function(e){n.uploadFileAsync(t,e)},function(e,i){var o=n.observables[t];o.innerHTML=t+" &ndash; "+i+"%"});i.readAsDataURL(e)},e.prototype.uploadFileAsync=function(e,t){var n=this,i={fileName:e,base64:t};if(this.config.testMode)return void setTimeout(function(){n.config.callback&&n.config.callback({success:!0}),n.observables[e].innerHTML=e+" &ndash; uploaded."},2e3);var o=new XMLHttpRequest;o.open("POST",n.config.url),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText);n.config.callback&&n.config.callback(t),n.observables[e].innerHTML=e+" &ndash; uploaded."}},o.send(JSON.stringify(i))},e.prototype.getFileReader=function(t,n,i){if(t=t||this,!(t instanceof e))throw"Lost scope of this!";var o=new FileReader;return o.onerror=function(e){var t=void 0;switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:t="File Not Found!";break;case e.target.error.NOT_READABLE_ERR:t="File is not readable.";break;case e.target.error.ABORT_ERR:break;default:t="An error occurred reading this file."}t&&alert(t)},o.onprogress=function(e){var t=e.lengthComputable?Math.round(e.loaded/e.total*100):0;i&&i(e,t)},o.onabort=function(){alert("File upload cancelled.")},o.onload=function(e){var t=e.target.result;t.indexOf(",")>-1&&(t=t.split(",")[1]),n(t)},o},e.prototype.cancel=function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},e.prototype.cleanFileName=function(e){return e.name.replace(/[^a-zA-Z0-9_\-\.]/g,"")},e.prototype.isValidExtension=function(e){var t=/\.\w{2,4}$/.exec(e);if(!t)return!1;t=t[0];var n=(e.replace(new RegExp(t+"$"),""),new RegExp("^(\\.|)("+this.config.allowedExtensions.join("|")+")$","i").test(t));return n},e.prototype.downloadFile=function(e,t,n){n=n||"application/octet-stream";var i=document.createElement("a");i.setAttribute("href","data:"+n+";base64,"+e),i.setAttribute("download",t),document.body.appendChild(i),i.click(),document.body.removeChild(i)},e}();window.Cafe=function(){function e(e){return void 0===e&&(e=void 0),e&&(this.asyncFns=e),this}return e.prototype.start=function(e){void 0===e&&(e=void 0),this.next(!0,e)},e.prototype.complete=function(e){return this._complete=e,this},e.prototype.fail=function(e){return this._fail=e,this},e.prototype.finally=function(e){return this._finally=e,this},e.prototype.next=function(e,t,n){if(void 0===e&&(e=!0),void 0===t&&(t=void 0),void 0===n&&(n=void 0),!this.asyncFns)throw"Error in Cafe: The required parameter `asyncFns` of type (Array<Function>) is undefined. Don't forget to instantiate Cafe with this parameter or set its value after instantiation.";return this._complete&&this._complete(t,e,n),e?0==this.asyncFns.length?void(this._finally&&this._finally(t,e,n)):void this.asyncFns.shift()(this,n):void(this._fail&&this._fail(t,e,n))},e}();